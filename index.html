<!doctype html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="靖哥哥的技术博客">
<meta property="og:type" content="website">
<meta property="og:title" content="欢迎光临我的技术博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="欢迎光临我的技术博客">
<meta property="og:description" content="靖哥哥的技术博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="欢迎光临我的技术博客">
<meta name="twitter:description" content="靖哥哥的技术博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>欢迎光临我的技术博客</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">欢迎光临我的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">吹一吹</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/21/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jingchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欢迎光临我的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/21/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-21T19:12:21+08:00">
                2017-04-21
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/21/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/04/21/hello-world/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/04/06/matrix decomposition/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jingchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欢迎光临我的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/06/matrix decomposition/" itemprop="url">
                  矩阵分解及其应用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-06T22:23:00+08:00">
                2017-04-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/06/matrix decomposition/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/04/06/matrix decomposition/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="预备"><a href="#预备" class="headerlink" title="预备"></a>预备</h2><blockquote>
<ul>
<li>定义1，给定一个由$n$维向量集合组成的集合$V$，如果集合$V$非空并且对于任意集合$V$中的向量，满足如下两个条件<br>1) 若$a\in V,b\in V$ ,则$a+b\in V$；<br>2) 若$a\in V,\lambda \in R$，则$\lambda a \in V$；<br>则称集合$V$为向量空间</li>
</ul>
</blockquote>
<p>定义1说明在向量空间中，对向量加和运算和向量数乘运算封闭</p>
<blockquote>
<ul>
<li>定义2，设$V$为向量空间，如果$r$个向量$a_{1},a_{2}，\cdots，a_{n} \in V$，并且满足<br>1)$a_{1},a_{2}，\cdots，a_{n}$线性无关；<br>2)$V$中任一向量都可由$a_{1},a_{2}，\cdots，a_{n}$线性标示；<br>则称向量组$a_{1},a_{2}，\cdots，a_{n}$为向量空间$V$的一个基，$n$称为向量空间$V$的维数</li>
</ul>
</blockquote>
<p>给定向量空间$V$下的一个向量$x$，如果存在    </p>
<center>$x=\lambda_{1}a_{1}+\lambda_{2}a_{2}+\cdots+\lambda_{n}a_{n}$</center>    

<p>则称数组$\lambda_{1},\lambda_{2},\cdots,\lambda_{n}$为向量$x$在基$a_{1},a_{2}，\cdots，a_{n}$下的坐标，向量$x$在基$a_{1},a_{2}，\cdots，a_{n}$下可以表示为    </p>
<center>$x=[\lambda_{1}, \lambda_{2},\cdots,\lambda_{n}]$ </center>

<blockquote>
<ul>
<li>定义3，自然基，在$n$维向量空间中取单位坐标向量组$e_{1},e_{2},\cdots e_{n}$作为基，向量空间中的任一向量可以表示为$x=x_{1}e_{1} + x_{2}e_{2}+ \cdots + x_{n}e_{n}$,称$e_{1},e_{2},\cdots e_{n}$为自然基，向量$x=[x_{1},x_{2},\cdots,x_{n}]$</li>
</ul>
</blockquote>
<p>在定义3中的自然基，任何两个基向量的内积为0，称基向量之间正交，每个基的模为1，称为单位向量。对一个基，如果任意一个向量为单位向量且任意两个向量正交，则称为规范正交基。    </p>
<blockquote>
<ul>
<li>定义4，正交矩阵，如果一个$n$阶方阵满足$A^TA=E(即A^{-1}=A^T)$，则称方阵$A$为正交矩阵    </li>
</ul>
</blockquote>
<p>从正交矩阵的定义，可以导出正交矩阵行矩阵或列矩阵两两正交且模为1，假设$A$列矩阵为    </p>
<center><br>$A^{T}A=\begin{bmatrix}<br>x_{1}^{T}\ <br>x_{2}^{T}\ <br>\vdots\ <br>x_{n}^{T}<br>\end{bmatrix}<br>\begin{bmatrix}<br>x_{1} &amp;x_{2}  &amp; \cdots  &amp; x_{n}<br>\end{bmatrix}<br>=<br>\begin{bmatrix}<br>1 &amp; 0 &amp;  0&amp; 0\ <br>0 &amp; 1 &amp;  0&amp; 0\ <br>\vdots &amp;  \vdots&amp; \vdots &amp; \vdots\ <br> 0&amp; 0 &amp; 0 &amp; 1<br>\end{bmatrix}<br>\Longrightarrow<br>a_{i}^{T}a_{j}=\delta_{ij}<br>=<br>\left\{\begin{matrix}<br>1,如果i=j\ <br>0,否则i\ne j<br>\end{matrix}\right.<br>$<br></center>


<blockquote>
<ul>
<li>定义5，称变换$T$是线性的，如果<br>1）对于$T$定义域内的一切$u,v$，$T(u+v)=T(u)+T(v)$<br>2) 对一切$u$和标量c，$T(cu)=cT(u)$     </li>
<li>定义6，矩阵变换，称一个矩阵乘以一个向量为一个矩阵变换，记作$x\to Ax$</li>
</ul>
</blockquote>
<p>一个变换就是一个映射，由定义可以看出，矩阵变换$x\to Ax$是一个线性变换</p>
<h2 id="矩阵的几何意义"><a href="#矩阵的几何意义" class="headerlink" title="矩阵的几何意义"></a>矩阵的几何意义</h2><p>我们知道对于一个向量，给定一组基下就会有一个坐标唯一描述这个向量，假如有两个基描述这个向量，这两个基有什么关系呢？假设向量空间$V$有两组基$a_{1},a_{2},\cdots,a_{n}和b_{1},b_{2},\cdots,b_{n}$，则基$b$可以由$a$来表示，即有</p>
<center>$\left\{\begin{matrix}<br>b_{1}=p_{11}a_{1}+p_{21}a_{2}+\cdots +p_{n1}a_{n}\ <br>b_{2}=p_{12}a_{1}+p_{22}a_{2}+\cdots +p_{n2}a_{n}\ <br>\cdots \ <br>b_{n}=p_{1n}a_{1}+p_{2n}a_{2}+\cdots +p_{nn}a_{n}<br>\end{matrix}\right.$</center>

<p>写成矩阵形式，则有</p>
<center><br>$\begin{bmatrix}<br>b_{1}\ <br>b_{2}\ <br>\vdots\ <br>b_{n}<br>\end{bmatrix}<br>=<br>\begin{bmatrix}<br>p_{11} &amp; p_{21} &amp; \cdots &amp; p_{n1}\ <br>p_{12} &amp; p_{22} &amp; \cdots &amp; p_{n2}\ <br>\vdots &amp; \vdots &amp; \vdots &amp; \vdots\ <br>p_{1n} &amp; p_{n2} &amp; \cdots &amp; p_{nn}<br>\end{bmatrix}<br>\begin{bmatrix}<br>a_{1}\ <br>a_{2}\ <br>\vdots\ <br>a_{n}<br>\end{bmatrix}<br>=P^{T}<br>\begin{bmatrix}<br>a_{1}\ <br>a_{2}\ <br>\vdots\ <br>a_{n}<br>\end{bmatrix}<br>$<br></center>

<p>称矩阵$P$为从基$a$到基$b$的过渡矩阵,因为基是线性无关的，因此矩阵$P$是可逆的，也就是说，两个基之间可以通过一个矩阵来转换。</p>
<blockquote>
<ul>
<li>定理1，设$V_{n}$中的一个向量$r$,在基$a_{1},a_{2},\cdots,a_{n}$下的坐标为$[ x_{1},x_{2},\cdots,x_{n}]$，在基$b_{1},b_{2},\cdots,b_{n}$下的坐标为$[x_{1}’,x_{2}’,\cdots,x_{n}’]$，矩阵$P$为从基$a$到基$b$的过渡矩阵，则有坐标变换公式<center>$\begin{bmatrix}<br>x_{1}\ <br>x_{2}\ <br>\vdots\ <br>x_{n}<br>\end{bmatrix}<br>=<br>P<br>\begin{bmatrix}<br>x_{1}’\ <br>x_{2}’\ <br>\vdots\ <br>x_{n}’<br>\end{bmatrix}$<br></center>

</li>
</ul>
</blockquote>
<p>来看一个特殊的情况，假设基向量$a$为自然基，则有</p>
<center><br>$\begin{bmatrix}<br>b_{1}\ <br>b_{2}\ <br>\vdots\ <br>b_{n}<br>\end{bmatrix}<br>=<br>\begin{bmatrix}<br>p_{11} &amp; p_{21} &amp; \cdots &amp; p_{n1}\ <br>p_{12} &amp; p_{22} &amp; \cdots &amp; p_{n2}\ <br>\vdots &amp; \vdots &amp; \vdots &amp; \vdots\ <br>p_{1n} &amp; p_{n2} &amp; \cdots &amp; p_{nn}<br>\end{bmatrix}<br>\begin{bmatrix}<br>a_{1}\ <br>a_{2}\ <br>\vdots\ <br>a_{n}<br>\end{bmatrix}<br>=P^{T}<br>$<br></center>

<p>因此，一个向量在标准坐标系下坐标为$x=[x_{1},x_{2},\cdots,x_{n}]$,在基$b$下的坐标为$x’=x^{T}[b_{1}^{T},b_{2}^{T},\cdots,b_{n}^{T}]$,公式也可以写作</p>
<center>$EX^{T}=BX’^{T}$</center><br>也就是矩阵乘法$AX=b$可以认为是在标准坐标系下坐标是$b$，在$A$组成的基下的坐标是$x$<br><br>给定一个矩阵$A$,矩阵$Ax$可以看成一个基变换，如果认为基变换前后是同一个基，则可以认为$Ax$是对向量进行角度及长度的变换，矩阵可以认为是一个线性变换，也就是变换基坐标和变换向量是相对的<br><br>下面用二维图示进行说明，给定一个二维对角矩阵<br><center><br>$M=\begin{bmatrix}<br>3 &amp; 0\ <br>0 &amp; 1<br>\end{bmatrix}$<br></center><br>从几何上讲，$M$是将二维平面上的点$(x,y)$经过线性变换到另外一个点的变换矩阵<br><center><br>$M=\begin{bmatrix}<br>3 &amp; 0\ <br>0 &amp; 1<br>\end{bmatrix}<br>\begin{bmatrix}<br>x\ <br>y<br>\end{bmatrix}<br>=<br>\begin{bmatrix}<br>3x\ <br>y<br>\end{bmatrix}<br>$<br></center><br>变换的效果如下图所示，变换后的平面仅仅是沿 X 水平方面进行了拉伸3倍，垂直方向是并没有发生变化。<br><center><br><img src="../image/1.jpg" alt=""><br></center><br>现在看下矩阵<br><center><br>$M=\begin{bmatrix}<br>2 &amp; 1\ <br>1 &amp; 2<br>\end{bmatrix}<br>\begin{bmatrix}<br>x\ <br>y<br>\end{bmatrix}<br>=<br>\begin{bmatrix}<br>2x+y\ <br>x+2y<br>\end{bmatrix}<br>$<br></center><br>这个矩阵产生的变换效果如下图所示<br><center><br><img src="../image/2.jpg" alt=""><br></center><br> 这种变换效果看起来非常的奇怪，在实际环境下很难描述出来变换的规律 ( 这里应该是指无法清晰辨识出旋转的角度，拉伸的倍数之类的信息)。还是基于上面的对称矩阵，假设我们把左边的平面旋转45度角，然后再进行矩阵$M$的线性变换，效果如下图所示：<br><center><br><img src="../image/3.jpg" alt=""><br></center>

<p>看起来是不是有点熟悉？ 对的，经过 M 线性变换后，跟前面的对角矩阵的功能是相同的，都是将网格沿着一个方向拉伸了3倍。</p>
<p>从上边看出，一个矩阵可以对向量进行旋转和拉伸作用，有没有矩阵对向量仅仅进行旋转变化，不进行拉伸呢？正交变换就仅仅对向量进行旋转，不进行拉伸</p>
<blockquote>
<ul>
<li>定理二，若$P$为正交矩阵，则线性变换$y=Px$称为正交变换，并且变换后向量大小不变</li>
</ul>
</blockquote>
<p>向量是否拉伸可以通过向量的2阶范数来反映，即</p>
<center><br>$\parallel y \parallel =\sqrt{y^{T}y}=\sqrt{x^{T}P^{T}Px}=\sqrt{x^{T}x}=\parallel x \parallel$<br></center>

<p>下面以一个图示来演示正交变换,假设二维空间中的一个向量$OA$，它在标准坐标系也即$e1、e2$表示的坐标是中表示为$(a,b)^{T}$，现在把它用另一组坐标$e1’、e2’$表示为$(a’,b’)^{T}$，存在矩阵$U$使得$U(a’,b’)^{T}=(a,b)^{T}$</p>
<center><br><img src="../image/4.jpg" alt=""><br></center>

<p>容易求出$U$，其中$e_{1}’=[\cos\theta,\sin\theta]^{T}，e_{2}’=[-\sin\theta,\cos\theta]$，因此</p>
<center>$U=\begin{bmatrix}<br>\cos\theta &amp; -\sin\theta\ <br>\sin\theta &amp; \cos\theta<br>\end{bmatrix}$</center>

<p>下图展示了基变换和向量方向变换的等价</p>
<center><br><img src="../image/5.jpg" alt=""><br></center>

<p>有没有矩阵变换，仅仅对向量进行拉伸，不改变方向呢，这就是方阵的特征值和特征向量</p>
<h2 id="方阵的特征值及特征向量"><a href="#方阵的特征值及特征向量" class="headerlink" title="方阵的特征值及特征向量"></a>方阵的特征值及特征向量</h2><blockquote>
<ul>
<li>定义7，设$A$是$n$阶矩阵，如果$\lambda$和$n$维非零列向量$x$满足如下关系<br><center>$Ax=\lambda x$</center><br>则称$\lambda$为矩阵$A$的特征值，向量$x$为矩阵$A$的特征向量</li>
</ul>
</blockquote>
<p>从定义看出，矩阵$A$仅仅对特征向量进行了$\lambda$的拉伸，假设所有的特征值组成可逆矩阵$Q$，特征值组成对角矩阵$\Sigma$，则矩阵$A$可以分解为</p>
<center>$A=Q\Sigma Q^{-1}$</center><br>以上称为矩阵的特征值分解<br><br><br>&gt;<em> 定义8，矩阵的相似性，设$A,B$都是$n$阶矩阵，如果存在可逆矩阵$P$,使得，<br><center>$P^{-1}AP=B$</center><br>则称$A,B$相似<br><br>&gt; </em> 定理三，如果$n$阶矩阵$A,B$相似，则他们有相同的特征多项式，从而有相同的特征值<br><br>容易证明<br><br><center>$\left | B-\lambda E \right | = \left | P^{-1}AP-P^{-1}(\lambda E)P \right | = \left | P^{-1}(A-<br>\lambda E)P \right | = \left | P^{-1} \right | \left | A-<br>\lambda E \right | \left | P \right | = \left | A-\lambda E \right | $ </center>

<p>因此，如果一个矩阵$A$跟一个上(下)三角矩阵或者对角阵相似，则对角线的$n$个值就是$A$的特征值。同理，对于$n$阶矩阵$A$，能否找到一个可逆矩阵$P$使得$P^{-1}AP=\Lambda$，其中$\Lambda$为对角矩阵，如果存在，则称方阵$A$的对角化分解。</p>
<p>首先来看如果存在可逆矩阵$P$，它会满足什么条件，根据定义，把可逆矩阵写成列向量，即$P=(p_{1},p_{2},\cdots,p_{n})$ ，根据$P^{-1}AP=\Lambda$ ,有$AP=\Lambda P$,既有</p>
<center><br>$A(p_{1},p_{2},\cdots,p_{n})=(p_{1},p_{2},\cdots,p_{n})\begin{bmatrix}<br>\lambda_{1} &amp;  &amp;  &amp; \ <br> &amp; \lambda_{2} &amp;  &amp; \ <br> &amp;  &amp; \ddots   &amp; \ <br> &amp;  &amp;  &amp;  \lambda_{n}<br>\end{bmatrix}<br>=(\lambda_{1}p_{1},\lambda_{2}p_{2},\cdots,\lambda_{n}p_{n})$<br></center>

<p>即，如果矩阵$A$能对角化，则对角化$\Lambda$为特征值组成的对角矩阵，可逆矩阵为特征向量组成的矩阵，因此特征值分解可以实现矩阵的对角化分解。</p>
<blockquote>
<ul>
<li>定理四，一个$n$矩阵能够对角化的充分必要条件是它有$n$个线性无关的特征向量。特别的，对于对称矩阵$A(即A^{T}=A)$，它的任意两个不同特征值对应的特征向量正交；并且必有正交阵$P$，使<br><center>$P^{-1}AP=P^{T}AP=\Lambda$</center><br>$\Lambda$为特征值组成的对角化矩阵</li>
</ul>
</blockquote>
<p>####矩阵相似的意义####<br>我们知道矩阵对应一个在给定基下的线性变换，如果同一个线性变换，在基$a$下的变换矩阵为$A$，在$b$下的变换矩阵为B，则$A,B$有什么关系呢?<br>根据基变换的性质，基$b$可以由基$a$和一个矩阵乘积来表示，即$b=aP$，则对于线性变换$L$有</p>
<center><br>$\begin{array}{l}<br>L(b)=L(a)P \ \Rightarrow<br>{[ L(b_1) \cdots L(b_n) ] = [ L(a_1) \cdots L(a_n) ]\; P }\ \Rightarrow<br>{(b_1\cdots b_n)B=(a_1\cdots a_n)AP}\ \Rightarrow<br>{(a_1\cdots a_n)PB=(a_1\cdots a_n)AP}\ \Rightarrow {PB=AP}<br>\ \Rightarrow {B=P^{-1}AP}<br>\end{array}$<br></center>

<p>也就是说，两个矩阵相似，表示这两个矩阵是在不同的基表示下的同一个线性变换，特别，可逆矩阵$P$为两个基的过渡矩阵</p>
<p>####特征值及特征向量的意义#####<br>根据矩阵相似的意义，方阵$A$的特征值分解可以理解两个不同基下的同一个变换，其中特征向量组成的矩阵是两个变换的过渡矩阵，特别的，假设其中一个基是自然基，则另一个基为$P$或者$P^{-1}$，假设对角阵对应的基为自然基，则方阵$A$对应的基为$P$，也就是向量$A$的变换是对自然基组成的向量做特征值大小的缩放。    </p>
<p>从线性空间的角度看，在一个定义了内积的线性空间里，对一个$n$阶对称方阵进行特征分解，就是产生了该空间的$n$个标准正交基，然后把矩阵投影到这$n$个基上。$n$个特征向量就是$n$个标准正交基，因为对称方阵的特征向量是一个正交矩阵，所以，而特征值的模则代表矩阵在每个基上的投影长度。特征值越大，说明矩阵在对应的特征向量上的方差越大，功率越大，信息量越多。</p>
<p>对于小方阵，特征值及特征向量可以通过定义来求得。下面来看怎么求特征值及特征向量，由定义式可有</p>
<center>$(A-\lambda E)x=0$</center><br>这是一个$n$个未知数$n$个方程的齐次线性方程组，因它有非零解的条件是特征多项式为$0$，即<br><center>$\left |A-\lambda E  \right |=0$</center>

<p>假设$n$阶方阵$A$的特征值分别为$\lambda_{1},\lambda_{2},\cdots,\lambda_{n}$，特征值有如下性质    </p>
<ul>
<li>1) $\lambda_{1}+\lambda_{2}+\cdots+\lambda_{n} = a_{11}+a_{22}+\cdots+a_{nn}$    </li>
<li>2) $\lambda_{1}\lambda_{2}\cdots\lambda_{n}=\left |A\right|$</li>
</ul>
<p>但对于大型的方阵，可以通过矩阵的QR分解来求。</p>
<h2 id="矩阵的奇异值分解"><a href="#矩阵的奇异值分解" class="headerlink" title="矩阵的奇异值分解"></a>矩阵的奇异值分解</h2><p>根据特征值分解的描述，特征值的大小可以看成矩阵在某一方向的拉伸大小，如果矩阵在某些方向上的拉伸比较小，也就是特征值比较小，如果不考虑这些特征值的影响，矩阵的变换作用影响不大，因此可以用特征值分解来降维。    </p>
<p>上面讲的特征值分解是针对方阵的，那么对于普通的矩阵，会有这样的分解吗？其实，对于任何矩阵矩阵$A_{mn}$，存在一个正交矩阵$U_{mm}$，一个正交矩阵$V_{nn}$，一个对角矩阵$\Lambda_{mn}$，使得</p>
<center>$A_{mn}=U_{mm}\Lambda_{mn}V^{T}_{nn}$</center><br>成立，这就是矩阵的奇异值分解。<br><br>首先对于任何$A_{mn}$，都有$A^{T}A$是对称矩阵，根据对称矩阵的特征分解，有<br><center>$A=Q\Sigma Q^{-1}$</center>

<p>假设我们得到一组正交基${v_1,v_2,\cdots,v_n}$，即$A^{T}Av_i = \lambda_iv_i$，下面看对正交基进行$A$线性变换的向量组${Av_1,Av_2,\cdots,Av_n}$</p>
<center><br>$(Av_{i},Av_{j})\\<br>=(Av_{i})^{T}(Av_{j})\\<br>=v^{T}_{i}A^{T}Av_{j}\\<br>=v^{T}_{i}(\lambda_{j}v_{j})\\<br>=\lambda_{j}v^{T}_iv_{j}\\<br>=0<br>$<br></center>

<p>也就是经过矩阵$A$线性变换后的基${Av_1,Av_2,\cdots,Av_n}$也是正交的，将其标准化，即将$Av_{i}$变换为</p>
<center><br>$$u_{i}=\frac{Av_{i}}{\left | Av_{i} \right | } = \frac{1}{\sqrt{\lambda_{i}}}Av_{i}$$<br></center><br>如果令$\delta_{i} = \sqrt{\lambda_{i}}$，称$\delta_{i}$为奇异值，则有$Av_{i} = \sqrt{\lambda_{i}}u_{i}$<br><br>假设矩阵$A$的秩为$rank(A)=r$，则$rank（A^{T}A）=rank(AA^{T})=rank(A)=r$，则对称矩阵$A^{T}A$有$r$个非零的特征值，因此对于这$r$个特征值对应的特征向量都有$Av_{i}\ne0$,而为$0$的特征值对应的特征向量都有$Av_{i}=0$<br><br>因此，由$u_1,u_2,\cdots,u_r$组成的基是一个正交基，如果$r<m$，通过正交化将其扩展为$r^{m}$上的正交基 <center=""><br>$AV=A(v_{1},v_{2},\cdots,v_{n})\\<br>=(Av_{1},Av_{2},\cdots,Av_{r},0,0,\cdots,0)\\<br>=(\delta_{1}u_{1},\delta_{2}u_{2},\cdots,\delta_{r}u_{r},0,0,\cdots.0)<br>=U\Sigma\\<br>\Longrightarrow A=U\Sigma V_{T}<br>$<br>

<p>$v_{i}$是对称矩阵$A^{T}A$的特征向量，称为$A$的右奇异向量，实际上$u_{i}$是$AA^{T}$的特征向量，称为$A$的左奇异向量。</p>
<p>写成分块形式如下</p>
<center><br>$A=\left[<br>\begin{array}{ccc|ccc}<br>    u_{1} &amp; \cdots &amp; u_{k} &amp; u_{k+1} &amp; \cdots &amp; u_{m}<br>\end{array}<br>\right]<br>\left[<br>\begin{array}{ccc|c}<br>\sigma_{1} &amp;  &amp; &amp;\\<br> &amp; \ddots &amp; &amp; 0\\<br> &amp;  &amp;  \sigma_{k} &amp; \ \hline<br> &amp;   &amp; &amp;   \\<br> &amp; 0 &amp; &amp; 0 \\<br> &amp;   &amp; &amp;   \\<br>\end{array}<br>\right]<br>\begin{bmatrix}<br>v^{T}_{1} \ <br>\vdots \ <br>v^{T}_{k}\ \hline<br>v^{T}_{k+1}\\<br>\vdots \\<br>v^{T}_{n}<br>\end{bmatrix}\\<br>\Longrightarrow<br>A=<br>\begin{bmatrix}<br>u_{1} &amp; \cdots &amp; u_{k}<br>\end{bmatrix}<br>\begin{bmatrix}<br>\sigma_{1} &amp; &amp; \\<br>&amp; \ddots &amp; \\<br>&amp; &amp; \sigma_{k}<br>\end{bmatrix}<br>\begin{bmatrix}<br>v^{T}_{1}\\<br>\vdots\\<br>v^{T}_{k}<br>\end{bmatrix}<br>+<br>\begin{bmatrix}<br>u_{k+1} &amp; \cdots &amp; u_{m}<br>\end{bmatrix}<br>\begin{bmatrix}<br>&amp; &amp; \\<br>&amp; 0 &amp; \\<br>&amp; &amp; \ <br>\end{bmatrix}<br>\begin{bmatrix}<br>v^{T}_{k+1}\\<br>\vdots\\<br>v^{T}_{n}<br>\end{bmatrix}\\<br>\Longrightarrow<br>A=<br>\begin{bmatrix}<br>u_{1} &amp; \cdots &amp; u_{k}<br>\end{bmatrix}<br>\begin{bmatrix}<br>\sigma_{1} &amp; &amp; \\<br>&amp; \ddots &amp; \\<br>&amp; &amp; \sigma_{k}<br>\end{bmatrix}<br>\begin{bmatrix}<br>v^{T}_{1}\\<br>\vdots\\<br>v^{T}_{k}<br>\end{bmatrix}<br>$<br></center><br>奇异值的意义跟特征值的意义相似，正交基$U_{mm}$表示原空间的正交基，正交基$V_{nn}$表示目标空间的正交基，而对角矩阵$\Lambda$表示变换的重要性<br><br>奇异值的应用<br>———–<br><br>####数据压缩<br>从分解公式看出，如果矩阵的秩$r$远小于$m,n$，则矩阵可以压缩标示而且又不失真，特别的如果忽略小的奇异值，还能对数据进行压缩，比如一张图像就是一个大的二维矩阵，如果是彩色的就是三个大矩阵，比如一幅$1000<em>1000$的图像$A$，存储就需要$1000000$个像素了，如果矩阵的秩是$r$，则总共需要存储的数据是$1000</em>r+r<em>r+1000+r$,如果考虑$k$大的特征值，只需要$1000</em>k+k*k+1000+k$<br><br>下面给出一个图像进行svd分解后选取不同的特征值进行图像还原的效果<br><center><br><img src="../image/lena.jpg" alt=""><br><img src="../image/6.jpg" alt=""><br><img src="../image/pic.jpg" alt=""><br><img src="../image/7.jpg" alt=""><br></center>


<p>####求解PCA</p>
<p>####隐语义分析(Latent Semantic Analysis)<br>在文本处理中，潜在语义分析（LSA）假设在词项和文档之间有一个潜在语义层，词汇和语义产生关联，文档也和语义产生关联。这样通过语义概念，可以将词项和文档放在一个语义空间中观察分析。比如文档分类问题，隐含的主题可以理解为文档属于什么主题的文档(体育，娱乐，科技等)，LSA使用SVD分解来求解，下面以一个例子来说明，假设有3个文档</p>
<center><br><img src="../image/8.jpg" alt=""><br></center>

<p>查询词：gold silver truck<br>首先把文档分词组织成一个二维矩阵，查询词组织成一个向量，如下</p>
<center><br><img src="../image/9.jpg" alt=""><br></center>

<p>对矩阵$A$进行SVD分解，结果如下</p>
<center><br><img src="../image/10.jpg" alt=""><br></center>

<p>只保留2个奇异值，则变为</p>
<center><br><img src="../image/11.jpg" alt=""><br></center><br>这样可以求得三个文档在语义空间上的映射为<br><center><br>d1(-0.4945, 0.6492)<br>d2(-0.6458, -0.7194)<br>d3(-0.5817, 0.2469)<br></center>

<p>将查询词映射到语义空间</p>
<center><br><img src="../image/12.jpg" alt=""><br></center>

<p>这样就可以用相似性来度量查询词跟文档的相关性了</p>
<center><br><img src="../image/13.jpg" alt=""><br></center>
</m$，通过正交化将其扩展为$r^{m}$上的正交基>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/13/curl-linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jingchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欢迎光临我的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/13/curl-linux/" itemprop="url">
                  Linux下curl的用法及shell处理json数据介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-13T14:03:01+08:00">
                2017-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/13/curl-linux/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/13/curl-linux/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="请求的url为什么要进行编码"><a href="#请求的url为什么要进行编码" class="headerlink" title="请求的url为什么要进行编码"></a>请求的url为什么要进行编码</h2><p>url(Uniform Resource Locator)统一资源定位符，即我们通常说的网址，完整的URL由这几个部分构成：</p>
<center> scheme://host:port/path?query#fragment </center>

<p>其中，</p>
<p>scheme:通信协议，常用的http,ftp,maito,https等；</p>
<p>host:主机，服务器(计算机)域名系统 (DNS) 主机名或 IP 地址；</p>
<p>port:端口号，整数，可选，省略时使用方案的默认端口，如http的默认端口为80,https的默认端口是443；</p>
<p>path:路径，由零或多个”/“符号隔开的字符串，一般用来表示主机上的一个目录或文件地址；</p>
<p>query:查询，可选，用于给动态网页（如使用CGI、ISAPI、PHP/JSP/ASP/ASP.NET等技术制作的网页）传递参数，可有多个参数，用”&amp;”符号隔开，每个参数的名和值用”=”符号隔开；</p>
<p>fragment:信息片断，字符串，用于指定网络资源中的片断。例如一个网页中有多个名词解释，可使用fragment直接定位到某一名词解释。(也称为锚点.)这个标志点不是统一资源标志符的一部分，而是让用户浏览器在获得了文件后来导航用的，因此它实际上不被送到服务器。</p>
<p>网络标准<a href="http://www.ietf.org/rfc/rfc1738.txt" target="_blank" rel="external">RFC 1738</a>对url的编码进行的规定</p>
<blockquote>
<p>只有字母和数字[0-9a-zA-Z]、一些特殊符号”$-_.+!*’(),”[不包括双引号]、以及某些保留字，才可以不经过编码直接用于URL</p>
</blockquote>
<p>除了上边的这些字符，在url中出现时，都要经过编码,RFC 1738没有规定具体的编码方法，而是交给应用程序（浏览器）自己决定，具体的编码方式可以查看这篇<a href="http://www.ruanyifeng.com/blog/2010/02/url_encoding.html" target="_blank" rel="external">文章</a>和<a href="https://www.zhihu.com/question/19673368" target="_blank" rel="external">这篇</a>，例如双引号可以用\来转义，汉字可以用其他编码方式来表示</p>
<p>shell下有个挺好用的工具curl，可以进行服务器之间的通信，但是如果请求的参数中有{}或者[]，例如请求参数是json格式，如<a href="http://abc.com/query?a=b&amp;c=d&amp;\{\&quot;name\&quot;:\&quot;1\&quot;,\&quot;age\&quot;:3\}，否则curl会进行多次的请求，因为在curl中，可以用{}来指定多个url，如http://site.{one,two,three}.com，这将请求三次，分别为one,two,three,用[]可以用来指定一个范围，如ftp://ftp.numericals.com/file[1-100].txt" target="_blank" rel="external">http://abc.com/query?a=b&amp;c=d&amp;\{\&quot;name\&quot;:\&quot;1\&quot;,\&quot;age\&quot;:3\}，否则curl会进行多次的请求，因为在curl中，可以用{}来指定多个url，如http://site.{one,two,three}.com，这将请求三次，分别为one,two,three,用[]可以用来指定一个范围，如ftp://ftp.numericals.com/file[1-100].txt</a></p>
<h2 id="curl详细介绍"><a href="#curl详细介绍" class="headerlink" title="curl详细介绍"></a>curl详细介绍</h2><p>curl是一个向服务器或者从服务器下载数据的传输工具，它支持HTTP, HTTPS, FTP, FTPS, SCP, SFTP, TFTP, DICT, TELNET, LDAP or FILE等协议，这个命令设计为不需要用户的干预来执行。curl提供了非常多有用的功能，比如代理支持，用户认证，HTTP POST ,FTP Upload,断点续传等等,curl所有传输相关功能都基于libcurl。</p>
<p>详细用法</p>
<blockquote>
<ul>
<li><strong>直接请求，返回源代码</strong><br>  curl <a href="http://wwww.baidu.com" target="_blank" rel="external">http://wwww.baidu.com</a></li>
<li><strong>保存网页内容</strong>，-o：将文件保存为命令行中指定的文件名的文件中,-O：使用URL中默认的文件名保存文件到本地<br>  curl -o [文件名] www.sina.com</li>
<li><strong>自动跳转,有的网址是自动跳转的</strong>。使用<code>-L</code>参数，curl就会跳转到新的网址。<br>  curl -L www.sina.com</li>
<li><strong>显示头信息</strong>    <code>-i</code>参数可以显示http response的头信息，连同网页代码一起。<code>-I</code>参数则是只显示http response的头信息。<br>  curl -i www.sina.com</li>
<li><strong>显示通信过程</strong>, <code>-v</code>参数可以显示一次http通信的整个过程，包括端口连接和http request头信息。–trace可以显示更详细内容<br>  curl -v www.sina.com<br>  curl –trace output.txt www.sina.com<br>  curl –trace-ascii output.txt www.sina.com</li>
<li><strong>发送表单信息</strong>,发送表单信息有GET和POST两种方法。GET方法相对简单，只要把数据附在网址后面就行。<br>  curl example.com/form.cgi?data=xxx<br>  POST方法必须把数据和网址分开，curl就要用到–data参数.<br>  curl -X POST –data “data=xxx” example.com/form.cgi<br>  如果你的数据没有经过表单编码，还可以让curl为你编码，参数是<code>--data-urlencode</code>。<br>  curl -X POST–data-urlencode “date=April 1” example.com/form.cgi  </li>
<li><strong>HTTP动词</strong>    curl默认的HTTP动词是GET，使用<code>-X</code>参数可以支持其他动词。<br> curl -X POST www.example.com<br> curl -X DELETE www.example.com</li>
<li><strong>文件上传</strong>  假定文件上传的表单是下面这样：</li>
</ul>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">enctype</span>=<span class="string">'multipart/form-data'</span> <span class="attr">action</span>=<span class="string">"upload.cgi"</span>&gt;</span></div><div class="line">　　　　	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">file</span> <span class="attr">name</span>=<span class="string">upload</span>&gt;</span></div><div class="line">　　　　	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">submit</span> <span class="attr">name</span>=<span class="string">press</span> <span class="attr">value</span>=<span class="string">"OK"</span>&gt;</span></div><div class="line">　　    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>则上传命令是curl –form upload=@localfilename –form press=OK [URL]        </li>
<li><strong>cookie</strong>  使用<code>--cookie</code>参数，可以让curl发送cookie。<br>  curl –cookie “name=xxx” www.example.com    </li>
<li><strong>增加头信息</strong> 有时需要在http request之中，自行增加一个头信息。<code>--header</code>参数就可以起到这个作用<br>  curl –header “Content-Type:application/json” <a href="http://example.com" target="_blank" rel="external">http://example.com</a>    </li>
<li><strong>HTTP认证</strong> 有些网域需要HTTP认证，这时curl需要用到<code>--user</code>参数。<br>  curl –user name:password example.com</li>
<li><strong>断点续传</strong> 通过使用-C选项可对大文件使用断点续传功能<br>  #当文件在下载完成之前结束该进程<br>  $ curl -O <a href="http://www.gnu.org/software/gettext/manual/gettext.html" target="_blank" rel="external">http://www.gnu.org/software/gettext/manual/gettext.html</a><br>  ##############             20.1%    <h1 id="通过添加-C选项继续对该文件进行下载，已经下载过的文件不会被重新下载"><a href="#通过添加-C选项继续对该文件进行下载，已经下载过的文件不会被重新下载" class="headerlink" title="通过添加-C选项继续对该文件进行下载，已经下载过的文件不会被重新下载"></a>通过添加-C选项继续对该文件进行下载，已经下载过的文件不会被重新下载</h1>  curl -C - -O <a href="http://www.gnu.org/software/gettext/manual/gettext.html" target="_blank" rel="external">http://www.gnu.org/software/gettext/manual/gettext.html</a><br>  ###############            21.1%    </li>
<li><strong>网络限速</strong> ,通过–limit-rate选项对CURL的最大网络使用进行限制<br> curl –limit-rate 1000B -O <a href="http://www.gnu.org/software/gettext/manual/gettext.html" target="_blank" rel="external">http://www.gnu.org/software/gettext/manual/gettext.html</a></li>
</ul>
</blockquote>
<h2 id="shell处理json"><a href="#shell处理json" class="headerlink" title="shell处理json"></a>shell处理json</h2><p>通常大部分接口都是json格式的，对于大部分程序语言，都有库或者函数来实现json的序列化和反序列化，shell中也有命令可以处理json数据，如<a href="https://stedolan.github.io/jq/tutorial/" target="_blank" rel="external">jq</a>命令，需要手动安装  </p>
<blockquote>
<ul>
<li>下载<a href="https://github.com/stedolan/jq/releases/download/jq-1.5/jq-1.5.tar.gz" target="_blank" rel="external">源码</a>，执行./configure &amp;&amp; make &amp;&amp; sudo make install  </li>
</ul>
</blockquote>
<p>测试</p>
<blockquote>
<ul>
<li>获取数据<br>  curl ‘<a href="https://api.github.com/repos/stedolan/jq/commits?per_page=5" target="_blank" rel="external">https://api.github.com/repos/stedolan/jq/commits?per_page=5</a>‘ &gt; json.data<br>  结果如下:</li>
</ul>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  &#123;</div><div class="line">    "sha": "d25341478381063d1c76e81b3a52e0592a7c997f",</div><div class="line">    "commit": &#123;</div><div class="line">      "author": &#123;</div><div class="line">        "name": "Stephen Dolan",</div><div class="line">        "email": "mu@netsoc.tcd.ie",</div><div class="line">        "date": "2013-06-22T16:30:59Z"</div><div class="line">      &#125;,</div><div class="line">      "committer": &#123;</div><div class="line">        "name": "Stephen Dolan",</div><div class="line">        "email": "mu@netsoc.tcd.ie",</div><div class="line">        "date": "2013-06-22T16:30:59Z"</div><div class="line">      &#125;,</div><div class="line">      "message": "Merge pull request #162 from stedolan/utf8-fixes\n\nUtf8 fixes. Closes #161",</div><div class="line">      "tree": &#123;</div><div class="line">        "sha": "6ab697a8dfb5a96e124666bf6d6213822599fb40",</div><div class="line">        "url": "https://api.github.com/repos/stedolan/jq/git/trees/6ab697a8dfb5a96e124666bf6d6213822599fb40"</div><div class="line">      &#125;,</div><div class="line">      "url": "https://api.github.com/repos/stedolan/jq/git/commits/d25341478381063d1c76e81b3a52e0592a7c997f",</div><div class="line">      "comment_count": 0</div><div class="line">    &#125;,</div><div class="line">    "url": "https://api.github.com/repos/stedolan/jq/commits/d25341478381063d1c76e81b3a52e0592a7c997f",</div><div class="line">    "html_url": "https://github.com/stedolan/jq/commit/d25341478381063d1c76e81b3a52e0592a7c997f",</div><div class="line">    "comments_url": "https://api.github.com/repos/stedolan/jq/commits/d25341478381063d1c76e81b3a52e0592a7c997f/comments",</div><div class="line">    "author": &#123;</div><div class="line">      "login": "stedolan",</div><div class="line">	...</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>高亮显示 用jq “.” json.data</li>
<li><p>获取数据某一项  jq “.[n]” json.data ,如 jq “.[1]” json.data</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">	&#123;</div><div class="line">  <span class="attr">"sha"</span>: <span class="string">"125071cf005e687d4beba9d5822b1c6a72d7d14c"</span>,</div><div class="line">  <span class="attr">"commit"</span>: &#123;</div><div class="line">    <span class="attr">"author"</span>: &#123;</div><div class="line">      <span class="attr">"name"</span>: <span class="string">"Nicolas Williams"</span>,</div><div class="line">      <span class="attr">"email"</span>: <span class="string">"nico@cryptonector.com"</span>,</div><div class="line">      <span class="attr">"date"</span>: <span class="string">"2017-02-04T06:11:10Z"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"committer"</span>: &#123;</div><div class="line">      <span class="attr">"name"</span>: <span class="string">"Nicolas Williams"</span>,</div><div class="line">      <span class="attr">"email"</span>: <span class="string">"nico@cryptonector.com"</span>,</div><div class="line">      <span class="attr">"date"</span>: <span class="string">"2017-02-04T06:11:10Z"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Fix handling of unsupported math functions"</span>,</div><div class="line">    <span class="attr">"tree"</span>: &#123;</div><div class="line">      <span class="attr">"sha"</span>: <span class="string">"98bbc0beba737efc16c7d345b3c06c88302f5912"</span>,</div><div class="line">      <span class="attr">"url"</span>: <span class="string">"https://api.github.com/repos/stedolan/jq/git/trees/98bbc0beba737efc16c7d345b3c06c88302f5912"</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"url"</span>: <span class="string">"https://api.github.com/repos/stedolan/jq/git/commits/125071cf005e687d4beba9d5822b1c6a72d7d14c"</span>,</div><div class="line">    <span class="attr">"comment_count"</span>: <span class="number">0</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"url"</span>: <span class="string">"https://api.github.com/repos/stedolan/jq/commits/125071cf005e687d4beba9d5822b1c6a72d7d14c"</span>,</div><div class="line">  <span class="attr">"html_url"</span>: <span class="string">"https://github.com/stedolan/jq/commit/125071cf005e687d4beba9d5822b1c6a72d7d14c"</span>,</div><div class="line">  <span class="attr">"comments_url"</span>: <span class="string">"https://api.github.com/repos/stedolan/jq/commits/125071cf005e687d4beba9d5822b1c6a72d7d14c/comments"</span>,</div><div class="line">  <span class="attr">"author"</span>: &#123;</div><div class="line">    <span class="attr">"login"</span>: <span class="string">"nicowilliams"</span>,</div><div class="line">    <span class="attr">"id"</span>: <span class="number">604851</span>,</div><div class="line">    <span class="attr">"avatar_url"</span>: <span class="string">"https://avatars.githubusercontent.com/u/604851?v=3"</span>,</div><div class="line">    <span class="attr">"gravatar_id"</span>: <span class="string">""</span>,</div><div class="line">    <span class="attr">"url"</span>: <span class="string">"https://api.github.com/users/nicowilliams"</span>,</div><div class="line">    <span class="attr">"html_url"</span>: <span class="string">"https://github.com/nicowilliams"</span>,</div><div class="line">    <span class="attr">"followers_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/followers"</span>,</div><div class="line">    <span class="attr">"following_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/following&#123;/other_user&#125;"</span>,</div><div class="line">    <span class="attr">"gists_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/gists&#123;/gist_id&#125;"</span>,</div><div class="line">    <span class="attr">"starred_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/starred&#123;/owner&#125;&#123;/repo&#125;"</span>,</div><div class="line">    <span class="attr">"subscriptions_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/subscriptions"</span>,</div><div class="line">    <span class="attr">"organizations_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/orgs"</span>,</div><div class="line">    <span class="attr">"repos_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/repos"</span>,</div><div class="line">    <span class="attr">"events_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/events&#123;/privacy&#125;"</span>,</div><div class="line">    <span class="attr">"received_events_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/received_events"</span>,</div><div class="line">    <span class="attr">"type"</span>: <span class="string">"User"</span>,</div><div class="line">    <span class="attr">"site_admin"</span>: <span class="literal">false</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"committer"</span>: &#123;</div><div class="line">    <span class="attr">"login"</span>: <span class="string">"nicowilliams"</span>,</div><div class="line">    <span class="attr">"id"</span>: <span class="number">604851</span>,</div><div class="line">    <span class="attr">"avatar_url"</span>: <span class="string">"https://avatars.githubusercontent.com/u/604851?v=3"</span>,</div><div class="line">    <span class="attr">"gravatar_id"</span>: <span class="string">""</span>,</div><div class="line">    <span class="attr">"url"</span>: <span class="string">"https://api.github.com/users/nicowilliams"</span>,</div><div class="line">    <span class="attr">"html_url"</span>: <span class="string">"https://github.com/nicowilliams"</span>,</div><div class="line">    <span class="attr">"followers_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/followers"</span>,</div><div class="line">    <span class="attr">"following_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/following&#123;/other_user&#125;"</span>,</div><div class="line">    <span class="attr">"gists_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/gists&#123;/gist_id&#125;"</span>,</div><div class="line">    <span class="attr">"starred_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/starred&#123;/owner&#125;&#123;/repo&#125;"</span>,</div><div class="line">    <span class="attr">"subscriptions_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/subscriptions"</span>,</div><div class="line">    <span class="attr">"organizations_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/orgs"</span>,</div><div class="line">    <span class="attr">"repos_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/repos"</span>,</div><div class="line">    <span class="attr">"events_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/events&#123;/privacy&#125;"</span>,</div><div class="line">    <span class="attr">"received_events_url"</span>: <span class="string">"https://api.github.com/users/nicowilliams/received_events"</span>,</div><div class="line">    <span class="attr">"type"</span>: <span class="string">"User"</span>,</div><div class="line">    <span class="attr">"site_admin"</span>: <span class="literal">false</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"parents"</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"sha"</span>: <span class="string">"2fb099e4cfe5a9fedd55a1ace44ae2c5ee02cb12"</span>,</div><div class="line">      <span class="attr">"url"</span>: <span class="string">"https://api.github.com/repos/stedolan/jq/commits/2fb099e4cfe5a9fedd55a1ace44ae2c5ee02cb12"</span>,</div><div class="line">      <span class="attr">"html_url"</span>: <span class="string">"https://github.com/stedolan/jq/commit/2fb099e4cfe5a9fedd55a1ace44ae2c5ee02cb12"</span></div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>自定义格式输出某一项<br>  jq ‘.[0] | {message: .commit.message, name: .commit.committer.name}’    </p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"> 		<span class="attr">"message"</span>: <span class="string">"Add more missing math functions"</span>,</div><div class="line"> 		<span class="attr">"name"</span>: <span class="string">"Nicolas Williams"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p>这里 | 后面的内容是以前面的内容为输入的，.commit 中的 . 就是指 .[0] 中的内容。</p>
<blockquote>
<ul>
<li>自定义格式输出多项<br>  jq ‘.[] | {message: .commit.message, name: .commit.committer.name}’<br>  也就是如果要指定去数组中的某一项，需要指定一个值，否则就用一个[]标示取所有的，结果是:   </li>
</ul>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">  <span class="attr">"message"</span>: <span class="string">"Merge pull request #162 from stedolan/utf8-fixes\n\nUtf8 fixes. Closes #161"</span></div><div class="line">&#125;</div><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">  <span class="attr">"message"</span>: <span class="string">"Reject all overlong UTF8 sequences."</span></div><div class="line">&#125;</div><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">  <span class="attr">"message"</span>: <span class="string">"Fix various UTF8 parsing bugs.\n\nIn particular, parse bad UTF8 by replacing the broken bits with U+FFFD\nand resychronise correctly after broken sequences."</span></div><div class="line">&#125;</div><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">  <span class="attr">"message"</span>: <span class="string">"Fix example in manual for `floor`. See #155."</span></div><div class="line">&#125;</div><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"Nicolas Williams"</span>,</div><div class="line">  <span class="attr">"message"</span>: <span class="string">"Document floor"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到上边输出不是一个标准的json，修改如下</p>
<blockquote>
<ul>
<li>以数组形式自定义输出多项<br>  jq ‘[.[] | {message: .commit.message, name: .commit.committer.name}]’</li>
</ul>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Merge pull request #162 from stedolan/utf8-fixes\n\nUtf8 fixes. Closes #161"</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Reject all overlong UTF8 sequences."</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Fix various UTF8 parsing bugs.\n\nIn particular, parse bad UTF8 by replacing the broken bits with U+FFFD\nand resychronise correctly after broken sequences."</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Fix example in manual for `floor`. See #155."</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Nicolas Williams"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Document floor"</span></div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>获取其他内容<br>  jq ‘[.[] | {message: .commit.message, name: .commit.committer.name, parents: [.parents[].html_url]}]’</li>
</ul>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">	[</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"parents"</span>: [</div><div class="line">      <span class="string">"https://github.com/stedolan/jq/commit/54b9c9bdb225af5d886466d72f47eafc51acb4f7"</span>,</div><div class="line">      <span class="string">"https://github.com/stedolan/jq/commit/8b1b503609c161fea4b003a7179b3fbb2dd4345a"</span></div><div class="line">    ],</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Merge pull request #162 from stedolan/utf8-fixes\n\nUtf8 fixes. Closes #161"</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"parents"</span>: [</div><div class="line">      <span class="string">"https://github.com/stedolan/jq/commit/ff48bd6ec538b01d1057be8e93b94eef6914e9ef"</span></div><div class="line">    ],</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Reject all overlong UTF8 sequences."</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"parents"</span>: [</div><div class="line">      <span class="string">"https://github.com/stedolan/jq/commit/54b9c9bdb225af5d886466d72f47eafc51acb4f7"</span></div><div class="line">    ],</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Fix various UTF8 parsing bugs.\n\nIn particular, parse bad UTF8 by replacing the broken bits with U+FFFD\nand resychronise correctly after broken sequences."</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"parents"</span>: [</div><div class="line">      <span class="string">"https://github.com/stedolan/jq/commit/3dcdc582ea993afea3f5503a78a77675967ecdfa"</span></div><div class="line">    ],</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Stephen Dolan"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Fix example in manual for `floor`. See #155."</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    <span class="attr">"parents"</span>: [</div><div class="line">      <span class="string">"https://github.com/stedolan/jq/commit/7c4171d414f647ab08bcd20c76a4d8ed68d9c602"</span></div><div class="line">    ],</div><div class="line">    <span class="attr">"name"</span>: <span class="string">"Nicolas Williams"</span>,</div><div class="line">    <span class="attr">"message"</span>: <span class="string">"Document floor"</span></div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>这里用 .parents[].html_url 获取当前项的 parents 节点中的所有项的 html_url 属性的内容，然后两边加个中括号组装成数组输出。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/03/08/java-Instrument/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jingchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欢迎光临我的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/08/java-Instrument/" itemprop="url">
                  java Instrument 使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-08T16:57:25+08:00">
                2017-03-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/03/08/java-Instrument/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/03/08/java-Instrument/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Java在Java SE 5中提供了Instrumentation ，Instrumentation提供了通过Java方法来跟虚拟机交互的接口 JVM Tool interface，实际上是提供了一套代理机制，通过独立于JVM应用程序之外的程序来扩展修改应用程序，通过它可以对现有程序做一些扩展，比如系统监控，通过修改字节码可以实现接口相应时间，方法耗时，代码覆盖率等等功能，这样的特性实际上提供了一种虚拟机级别支持的AOP实现方式，使得开发者无需对JDK做任何升级和改动，就可以实现某些AOP的功能了。在Java SE 5中，代理程序需要在启动应用程序的时候执行代理jar包，在应用程序启动之前启动代理程序，这就限制了这个方法的应用，因为在线上系统，一旦一个系统出问题，不可能重启后在加上代理程序来定位问题，或者在应用程序启动时就加上代理程序，但代理程序通常会修改class字节码来扩展功能，可能会对线上系统性能有影响。在Java SE 6里面instrumentation 被赋予了更强大的功能：启动后的 instrument、本地代码（native code）instrument，以及动态改变classpath 等等。</p>
<h2 id="Java-SE-5方式"><a href="#Java-SE-5方式" class="headerlink" title="Java SE 5方式"></a>Java SE 5方式</h2><p><a href="http://docs.oracle.com/javase/8/docs/platform/jvmti/jvmti.html" target="_blank" rel="external">JVM TI</a>是一个编程接口，通过它可以监控和控制应用程序在JVM中的执行，提供了一些接口，包括调试，监控，线程分析，覆盖率分析等工具，Java 的Instrumentation就是JVM TI的Java实现，在Java SE 5中，使用代理程序需要在类里边有一个premain方法，有两种定义</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">premain</span><span class="params">(String agentArgs, Instrumentation inst)</span></span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">premain</span><span class="params">(String agentArgs)</span></span>;</div></pre></td></tr></table></figure>
<p>其中上边的有更高的优先级    </p>
<p>在应用启动时启动代理程序，需要用如下的命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">java -javaagent:jarpath option java_main_class</div></pre></td></tr></table></figure>
<p>并且jar包有要求，需要在manifest文件中加上Premain-Class属性，值为代理类的全路径</p>
<p>下边通过一个简单的例子来演示应用，通过它来演示JVM加载了哪些类</p>
<ul>
<li>首先定义代理类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zlq;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.instrument.ClassFileTransformer;</div><div class="line"><span class="keyword">import</span> java.lang.instrument.IllegalClassFormatException;</div><div class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</div><div class="line"><span class="keyword">import</span> java.security.ProtectionDomain;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by liqing.zhan on 2017/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoadClassInst</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">premain</span><span class="params">(String agentArgs, Instrumentation inst)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"LoadClassInst premain start"</span>);</div><div class="line">        inst.addTransformer(<span class="keyword">new</span> LoadClassTransformer());</div><div class="line">        System.out.println(<span class="string">"LoadClassInst premain end"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoadClassTransformer</span> <span class="keyword">implements</span> <span class="title">ClassFileTransformer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,</div><div class="line">                            ProtectionDomain protectionDomain, <span class="keyword">byte</span>[] classfileBuffer)</div><div class="line">            <span class="keyword">throws</span> IllegalClassFormatException &#123;</div><div class="line">        System.out.println(String.format(<span class="string">"load class %s"</span>, className));</div><div class="line">        <span class="keyword">return</span> classfileBuffer;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>定义应用程序</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zlq;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by liqing.zhan on 2017/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        System.out.println(Main.class.getSimpleName());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>将代理类打成jar包，pom文件如下</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zlq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">archive</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">addClasspath</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addClasspath</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">manifestEntries</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">Premain-Class</span>&gt;</span></div><div class="line">                                com.zlq.LoadClassInst</div><div class="line">                            <span class="tag">&lt;/<span class="name">Premain-Class</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">manifestEntries</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>执行main方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">$ java  -javaagent:test-<span class="number">1.0</span>-SNAPSHOT.jar com.zlq.Main</div><div class="line">LoadClassInst premain start</div><div class="line">LoadClassInst premain end</div><div class="line">load <span class="class"><span class="keyword">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">invoke</span>/<span class="title">MethodHandleImpl</span></span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">invoke</span>/<span class="title">MemberName</span>$<span class="title">Factory</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">invoke</span>/<span class="title">LambdaForm</span>$<span class="title">NamedFunction</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">invoke</span>/<span class="title">MethodType</span>$<span class="title">ConcurrentWeakInternSet</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">invoke</span>/<span class="title">MethodHandleStatics</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">invoke</span>/<span class="title">MethodHandleStatics</span>$1</div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">invoke</span>/<span class="title">MethodTypeForm</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">invoke</span>/<span class="title">Invokers</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">invoke</span>/<span class="title">MethodType</span>$<span class="title">ConcurrentWeakInternSet</span>$<span class="title">WeakEntry</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Void</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">IllegalAccessException</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">sun</span>/<span class="title">misc</span>/<span class="title">PostVMInitHook</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">sun</span>/<span class="title">launcher</span>/<span class="title">LauncherHelper</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">com</span>/<span class="title">zlq</span>/<span class="title">Main</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">sun</span>/<span class="title">launcher</span>/<span class="title">LauncherHelper</span>$<span class="title">FXHelper</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Class</span>$<span class="title">MethodArray</span></div><div class="line"><span class="title">Main</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Shutdown</span></div><div class="line"><span class="title">load</span> <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Shutdown</span>$<span class="title">Lock</span></div></pre></td></tr></table></figure>
<h2 id="Java-Attach-API"><a href="#Java-Attach-API" class="headerlink" title="Java Attach API"></a>Java Attach API</h2><p>使用<a href="https://blogs.oracle.com/CoreJavaTechTips/entry/the_attach_api" target="_blank" rel="external">Java Attach API</a><br>可以获取目标JVM的一个引用，通过这个引用，就可以操纵JVM。 在两个包下边，com.sun.tools.attach和com.sun.tools.attach.spi，VirtualMachine这个类标示一个JVM实例，需要通过进程ID来关联，拿到JVM的实例，就可以调用loadAgent(age)来扩展功能，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">VirtualMachine vm = VirtualMachine.attach (processid);</div><div class="line">String agent = ...</div><div class="line">vm.loadAgent(agent);</div></pre></td></tr></table></figure>
<p>VirtualMachine也提供了一个遍历所有JVM实例的方法,例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">String name = ...</div><div class="line">List vms = VirtualMachine.list();</div><div class="line"><span class="keyword">for</span> (VirtualMachineDescriptor vmd: vms) &#123;</div><div class="line">    <span class="keyword">if</span> (vmd.displayName().equals(name)) &#123;</div><div class="line">        VirtualMachine vm = VirtualMachine.attach(vmd.id());</div><div class="line">        String agent = ...</div><div class="line">        vm.loadAgent(agent);</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在调用完loadAgent后需要调用deatch来取消附着，<a href="https://blogs.oracle.com/CoreJavaTechTips/entry/the_attach_api" target="_blank" rel="external">文档</a>有一些例子可以学习</p>
<h2 id="JAVA-SE-6-方式"><a href="#JAVA-SE-6-方式" class="headerlink" title="JAVA SE 6 方式"></a>JAVA SE 6 方式</h2><p>通过上边提到的Attach技术，可以在运行时动态的运行代理程序，就可以达到不用重启应用程序来扩展功能，具体方法跟Java SE 5差不多，也是需要一个代理jar包，需要写一个代理类，只不过这个类需要有一个agentmain方法，方法的定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">agentmain</span> <span class="params">(String agentArgs, Instrumentation inst)</span></span>;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">agentmain</span> <span class="params">(String agentArgs)</span></span>;</div></pre></td></tr></table></figure>
<p>其中，上边的优先级更高</p>
<p>在manifest中定义一个Agent-Class属性，通常在代理jar保重，Agent-Class和Premain-Class都有且都是一个类，这样在两种情况下都可以用，下面还是用一个简单的例子来说明</p>
<ul>
<li>编写代理程序</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zlq;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.instrument.ClassFileTransformer;</div><div class="line"><span class="keyword">import</span> java.lang.instrument.IllegalClassFormatException;</div><div class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</div><div class="line"><span class="keyword">import</span> java.security.ProtectionDomain;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by liqing.zhan on 2017/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoadClassInst</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">premain</span><span class="params">(String agentArgs, Instrumentation inst)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"LoadClassInst premain start"</span>);</div><div class="line">        inst.addTransformer(<span class="keyword">new</span> LoadClassTransformer());</div><div class="line">        System.out.println(<span class="string">"LoadClassInst premain end"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">agentmain</span><span class="params">(String agentArgs, Instrumentation inst)</span> </span>&#123;</div><div class="line">        Class[] classes = inst.getAllLoadedClasses();</div><div class="line">        <span class="keyword">for</span> (Class cls : classes) &#123;</div><div class="line">            System.out.println(cls.getName());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoadClassTransformer</span> <span class="keyword">implements</span> <span class="title">ClassFileTransformer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined,</div><div class="line">                            ProtectionDomain protectionDomain, <span class="keyword">byte</span>[] classfileBuffer)</div><div class="line">            <span class="keyword">throws</span> IllegalClassFormatException &#123;</div><div class="line">        System.out.println(String.format(<span class="string">"load class %s"</span>, className));</div><div class="line">        <span class="keyword">return</span> classfileBuffer;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>编写应用程序</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zlq;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by liqing.zhan on 2017/3/9.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        System.out.println(Main.class.getSimpleName());</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            TimeUnit.SECONDS.sleep(<span class="number">4</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>编写attach程序</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zlq;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.sun.tools.attach.AgentInitializationException;</div><div class="line"><span class="keyword">import</span> com.sun.tools.attach.AgentLoadException;</div><div class="line"><span class="keyword">import</span> com.sun.tools.attach.AttachNotSupportedException;</div><div class="line"><span class="keyword">import</span> com.sun.tools.attach.VirtualMachine;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by liqing.zhan on 2017/3/10.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AttachJVM</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, AttachNotSupportedException,</span></div><div class="line">            AgentLoadException, AgentInitializationException &#123;</div><div class="line">        String processId = args[<span class="number">0</span>];</div><div class="line">        String agentJarPath = args[<span class="number">1</span>];</div><div class="line">        VirtualMachine virtualMachine = VirtualMachine.attach(processId);</div><div class="line">        virtualMachine.loadAgent(agentJarPath);</div><div class="line">        virtualMachine.detach();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>先执行应用程序，拿到pid，再运行attach程序</p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>像btrace  greps 等工具都是应用Instrument技术，Google的dapper论文提到的分布式追踪技术也可以应用，动态的生成链路代码，打印日志，后台日志收集汇总，前台展示</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ul>
<li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html" target="_blank" rel="external">Java SE 6 新特性: Instrumentation 新功能</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-instrumentation/" target="_blank" rel="external">Java 5 特性 Instrumentation 实践</a></li>
<li><a href="http://jiangbo.me/blog/2012/02/21/java-lang-instrument/" target="_blank" rel="external">java.lang.instrument笔记</a></li>
<li><a href="http://www.infoq.com/cn/articles/javaagent-illustrated" target="_blank" rel="external">JVM源码分析之javaagent原理完全解读</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/08/java  split with 竖线/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jingchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欢迎光临我的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/08/java  split with 竖线/" itemprop="url">
                  Java中用竖线|对字符串split
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-08T14:14:40+08:00">
                2017-02-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index">
                    <span itemprop="name">java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/08/java  split with 竖线/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/08/java  split with 竖线/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Java中，对字符串进行spilt要特别注意，split里边的参数是一个正则表达式，如果参数是|，因为|在正则表达式里边是一个特殊字符，所以需要进行转义，否则结果跟预期的不符，例如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Split</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        String phone = <span class="string">"123456|789"</span>;</div><div class="line">        List&lt;String&gt; phones = Arrays.asList(phone.split(<span class="string">"|"</span>));</div><div class="line">        System.out.println(phones);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出结果是：</p>
<blockquote>
<p> [1, 2, 3, 4, 5, 6, |, 7, 8, 9]<br>而不是我们期望的[123456, 789]</p>
</blockquote>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>因为|在正则表达式中表示或者的意思，上边代码的意思是用空字符串或者空字符串进行分割，即同phone.split(“”)一样    </p>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>只需对|进行转义即可，因为\在Java中也是一个特殊字符，需要用\\\|对|进行转义<br>或者用Pattern.quote(“|”)来给加上转义字符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Split</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        String phone = <span class="string">"123456|789"</span>;</div><div class="line">        <span class="comment">//List&lt;String&gt; phones = Arrays.asList(phone.split"\\|");</span></div><div class="line">        List&lt;String&gt; phones = Arrays.asList(phone.split(Pattern.quote(<span class="string">"|"</span>)));</div><div class="line">        System.out.println(phones);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/23/test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jingchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欢迎光临我的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/23/test/" itemprop="url">
                  test
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-23T10:40:53+08:00">
                2017-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/test/" itemprop="url" rel="index">
                    <span itemprop="name">test</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/23/test/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/23/test/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#hahaha</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//dfdfdf</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</div><div class="line">        System.out.println(<span class="string">""</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>#####dfdfasdf</p>
<p>##hahaha</p>
<blockquote>
<ul>
<li>dddfd</li>
</ul>
</blockquote>
<p>$x = (-b +- sqrt(b^2-4ac))/(2a) .$<br>$\sqrt{3x-1}+(1+x)^2$ is an example of a \LaTeX  inline equation.he Lorenz Equations:<br>$$x=\frac{-b\pm\sqrt{b^2-4ac}}{2a}$$<br>$(x=\frac{-b\pm\sqrt{b^2-4ac}}{2a})$<br>$$\sum_{i=1}^n \frac{1}{i^2} \quad and \quad \prod_{i=1}^n \frac{1}{i^2} \quad and \quad \bigcup_{i=1}^{2} R$$</p>
<p>$$\begin{aligned}\dot{x} &amp; = \sigma(y-x) \\dot{y} &amp; = \rho x - y - xz \\dot{z} &amp; = -\beta z + xy\end{aligned}$$</p>
<p>$a_{a}^{b} ,b_{34}$</p>
<p>$a_{1},a_{2}，\cdots，a_{n} \in V$</p>
<p>$R_{m\times n}\approx P_{m\times k}\times Q_{k\times n}=\hat{R}_{m\times n}$</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/02/first/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jingchen">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欢迎光临我的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/02/first/" itemprop="url">
                  first
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-02T16:22:54+08:00">
                2016-12-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/algorithm/" itemprop="url" rel="index">
                    <span itemprop="name">algorithm</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/12/02/first/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/02/first/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapSort</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> values[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10001</span>];</div><div class="line">        initValues(values);</div><div class="line">        print(values);</div><div class="line">        shuffer(values);</div><div class="line">        print(values);</div><div class="line">        makeMaxHeap(values);</div><div class="line">        print(values);</div><div class="line">        heapSort(values);</div><div class="line">        print(values);</div><div class="line">        System.out.println(isSort(values, <span class="keyword">true</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSort</span><span class="params">(<span class="keyword">int</span> values[], <span class="keyword">boolean</span> asc)</span> </span>&#123;</div><div class="line">        <span class="keyword">boolean</span> sort = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">int</span> start = <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (asc) &#123;</div><div class="line">            <span class="keyword">while</span> (start &lt; values.length - <span class="number">2</span> &amp;&amp; sort) &#123;</div><div class="line">                sort &amp;= (values[start] &lt; values[start + <span class="number">1</span>]);</div><div class="line">                start++;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">while</span> (start &lt; values.length - <span class="number">2</span> &amp;&amp; sort) &#123;</div><div class="line">                sort &amp;= (values[start] &gt; values[start]);</div><div class="line">                start++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> sort &amp;&amp; start &gt;= (values.length - <span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="keyword">int</span> values[])</span> </span>&#123;</div><div class="line">        makeMaxHeap(values);</div><div class="line">        <span class="keyword">int</span> end = values.length;</div><div class="line"></div><div class="line">        <span class="keyword">while</span> (end &gt; <span class="number">2</span>) &#123;</div><div class="line">            swap(values, <span class="number">1</span>, end - <span class="number">1</span>);</div><div class="line">            change(values, <span class="number">1</span>, end - <span class="number">2</span>);</div><div class="line">            end--;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">shuffer</span><span class="params">(<span class="keyword">int</span> values[])</span> </span>&#123;</div><div class="line">        Random r = <span class="keyword">new</span> Random();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; values.length; i++) &#123;</div><div class="line">            <span class="keyword">int</span> j = r.nextInt(values.length - i) + i;</div><div class="line">            swap(values, i, j);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">initValues</span><span class="params">(<span class="keyword">int</span> values[])</span> </span>&#123;</div><div class="line">        values[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; values.length; i++) &#123;</div><div class="line">            values[i] = i;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">makeMaxHeap</span><span class="params">(<span class="keyword">int</span>[] values)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> middle = (values.length - <span class="number">1</span>) / <span class="number">2</span>;</div><div class="line">        <span class="keyword">while</span> (middle &gt; <span class="number">0</span>) &#123;</div><div class="line">            change(values, middle, values.length - <span class="number">1</span>);</div><div class="line">            middle--;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span>[] values)</span> </span>&#123;</div><div class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="string">"["</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.length; i++) &#123;</div><div class="line">            builder.append(values[i]).append(<span class="string">","</span>);</div><div class="line">        &#125;</div><div class="line">        builder.deleteCharAt(builder.length() - <span class="number">1</span>);</div><div class="line">        builder.append(<span class="string">"]"</span>);</div><div class="line">        System.out.println(builder.toString());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span>[] values, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> i = start;</div><div class="line">        <span class="keyword">while</span> (left(i) &lt;= end || right(i) &lt;= end) &#123;</div><div class="line">            <span class="keyword">int</span> idx = i;</div><div class="line">            <span class="keyword">int</span> max = values[idx];</div><div class="line">            <span class="keyword">int</span> now = idx;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (max &lt; values[left(i)]) &#123;</div><div class="line">                max = values[left(i)];</div><div class="line">                now = left(i);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (right(i) &lt;= end) &#123;</div><div class="line">                <span class="keyword">if</span> (max &lt; values[right(i)]) &#123;</div><div class="line">                    now = right(i);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (now != idx) &#123;</div><div class="line">                swap(values, idx, now);</div><div class="line">                i = now;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] values, <span class="keyword">int</span> idx, <span class="keyword">int</span> now)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> tmp = values[idx];</div><div class="line">        values[idx] = values[now];</div><div class="line">        values[now] = tmp;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">left</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">2</span> * n;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">right</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">2</span> * n + <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="jingchen" />
          <p class="site-author-name" itemprop="name">jingchen</p>
           
              <p class="site-description motion-element" itemprop="description">靖哥哥的技术博客</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jingchen</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zhanliqing"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  
















  





  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
